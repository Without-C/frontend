<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시영없는 시영팀</title>
</head>

<body>
    <h1>시영없는 시영팀</h1>

    <div>
        <button onclick="window.location.href='/api/auth/login/42'">
            42 로그인
        </button>

        <button onclick="window.location.href='/api/auth/logout'">
            로그아웃
        </button>

        <div id="username-element"></div>
        <img id="avatar-element" />

        <script>
            function getCookie(name) {
                const cookieName = name + "=";
                const decodedCookie = decodeURIComponent(document.cookie);
                const cookieArr = decodedCookie.split(';');
                for (let i = 0; i < cookieArr.length; i++) {
                    let cookie = cookieArr[i].trim();
                    if (cookie.indexOf(cookieName) === 0) {
                        return cookie.substring(cookieName.length, cookie.length);
                    }
                }
                return null;
            }
        </script>

        <script>
            const username = getCookie("username");
            const username_element = document.getElementById("username-element");
            if (username) {
                username_element.textContent = username;
            }
        </script>

        <script>
            const avatar_url = getCookie("avatar_url");
            const avatar_element = document.getElementById("avatar-element");
            if (avatar_url) {
                avatar_element.src = "/api/user/avatars/" + avatar_url;
                console.log(avatar_element.src);
            }
        </script>
    </div>

    <!-- web socket -->
    <div>
        <canvas id="ping-ping" width="600" height="400"></canvas>

        <script>
            const canvas = document.getElementById('ping-ping');
            const ctx = canvas.getContext('2d');

            function setCanvasMessage(message, background) {
                ctx.fillStyle = background;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.font = "bold 60px Arial";
                ctx.fillStyle = "white";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";

                ctx.fillText(message, canvas.width / 2, canvas.height / 2);
            }
        </script>

        <script>
            const chatSocket = new WebSocket(
                'ws://'
                + window.location.host
                + '/api/ping-pong/duel/ws/'
            );

            chatSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                console.log(data.message);

                setCanvasMessage(data.message, data.background);
            };

            chatSocket.onclose = function (e) {
                console.error('Chat socket closed unexpectedly');
            };
        </script>
    </div>
</body>

</html>
